#!/usr/bin/env bash
# set -euo pipefail

# Step 1: pick a tracked file
file=$(git ls-files | fzf --prompt="Pick a file: ")
[[ -z "$file" ]] && return 1

# Step 2: pick a commit that touched this file
commit=$(git log --date=short --pretty=format:'%cd %h %s' --follow -- "$file" \
  | fzf --ansi --prompt="Pick a commit: " \
        --preview "awk '{print \$2}' <<< {} | xargs -I{} git show --color=always --stat {} -- \"$file\"" \
  | awk '{print $2}')
[[ -z "$commit" ]] && return 1

# Step 3: show the diff for that commit, limited to the selected file
git diff "$commit"~ "$commit" -- "$file"
